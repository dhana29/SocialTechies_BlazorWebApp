@using Radzen
@using SocialTechies_BlazorWebApp.Data.Aws



@if (application.cpuUtilization == null) {
    <p><em>Loading...</em></p>
}
else {
<div class="chart-card">
    <h3>@application.instance.Name</h3>
        <div class="chart-container">
            <div class="col-sm-6 col-lg-4">
                <RadzenArcGauge Style="width: 100%; height: 250px;">
                    <RadzenArcGaugeScale Step="20" Min="0" Max="101" MinorStep="2" Radius="1.5" TickPosition=@GaugeTickPosition.Outside Y="0.9" Margin="0">
                        <RadzenArcGaugeScaleValue Value=@application.mostRecentDatapoint.Maximum ShowValue=true>
                            <Template Context="pointer">
                                <h4>
                                    @application.mostRecentDatapoint.Maximum.ToString("##0.00")<sup>%</sup>
                                </h4>
                            </Template>
                        </RadzenArcGaugeScaleValue>
                    </RadzenArcGaugeScale>
                </RadzenArcGauge>
            </div>
            <div class="col-sm-8">
                <RadzenChart>
                    <RadzenLineSeries Title=@application.chartName Data="@application.cpuUtilization.Datapoints" ValueProperty="Maximum" CategoryProperty="TimeStamp" Smooth="true">

                        <ChildContent>
                            <RadzenMarkers MarkerType="MarkerType.Circle" />
                        </ChildContent>
                        <TooltipTemplate Context="data">
                            <div>
                                <div><b>@data.TimeStamp.ToString("yyyy-MM-dd HH:mm tt"):</b></div>
                                @(data.Maximum.ToString("##0") ?? "Unknown")%
                            </div>
                        </TooltipTemplate>
                    </RadzenLineSeries>

                    <RadzenCategoryAxis Padding="20">


                    </RadzenCategoryAxis>

                    <RadzenValueAxis>
                        <RadzenGridLines Visible="false" />
                        <RadzenAxisTitle Text="% of CPU Utilized" />
                        <RadzenValueAxis Min="0" Max="100" Step="10" />
                    </RadzenValueAxis>

                </RadzenChart>
            </div>
        </div>
    </div>
}

@code {
    [Parameter]
    public ApplicationContext application { get; set; }

    public void Refresh() {
        StateHasChanged();
    }

    string FormatTime(object value) {
        var datetime = (DateTime)value;

        if (datetime.Hour == 0 && datetime.Minute == 0)
            return datetime.ToString("yyyy-MM-dd");


        return datetime.ToString("HH:mm");
    }
}
